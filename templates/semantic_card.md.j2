{# templates/semantic_card.md.j2 #}

# {{ card.title }}

## Labels

- **Grouping:** {% if card.labels and card.labels.grouping %}{{ card.labels.grouping | join(', ') }}{% else %}none{% endif %}

---

## Nodes (Shark_Name)

{% if card.parent_groups and (card.parent_groups | length) > 0 %}
{% for g in card.parent_groups %}
### {{ g.heading }} ({{ g.nodes | length }})

{% if g.nodes and (g.nodes | length) > 0 %}
{% for n in g.nodes %}
- {{ n }}
{% endfor %}
{% else %}
- *(none)*
{% endif %}

{% endfor %}
{% else %}
{% if card.node_names and (card.node_names | length) > 0 %}
{% for n in card.node_names %}
- {{ n }}
{% endfor %}
{% else %}
- *(none)*
{% endif %}
{% endif %}

---

## Properties

{% if card.properties and (card.properties | length) > 0 %}
| Property | Type | Required |
|---|---|---|
{% for p in card.properties %}
| {{ p.name }} | {{ p.type }} | {{ "Yes" if p.required else "No" }} |
{% endfor %}
{% else %}
*(none)*
{% endif %}

---

## Relationships

{% set rels_out = (card.relationships.outgoing if card.relationships and card.relationships.outgoing else []) %}
{% set rels_in  = (card.relationships.incoming if card.relationships and card.relationships.incoming else []) %}

### Outgoing

{% if rels_out and (rels_out | length) > 0 %}
{% set ns = namespace(current_from=None) %}
{% for r in rels_out | sort(attribute='from_name') %}
{% if ns.current_from != r.from_name %}
{% if not loop.first %}

{% endif %}
#### {{ r.from_name }}
{% set ns.current_from = r.from_name %}
{% endif %}

- **Relationship:** `{{ r.rel_type }}`
- **To:** {{ r.to_name }}
- **Source Labels:** {{ r.source_labels | join(', ') }}
- **Target Labels:** {{ r.target_labels | join(', ') }}

{% endfor %}
{% else %}
*(none)*
{% endif %}

### Incoming

{% if rels_in and (rels_in | length) > 0 %}
{% set ns2 = namespace(current_from=None) %}
{% for r in rels_in | sort(attribute='from_name') %}
{% if ns2.current_from != r.from_name %}
{% if not loop.first %}

{% endif %}
#### {{ r.from_name }}
{% set ns2.current_from = r.from_name %}
{% endif %}

- **Relationship:** `{{ r.rel_type }}`
- **To:** {{ r.to_name }}
- **Source Labels:** {{ r.source_labels | join(', ') }}
- **Target Labels:** {{ r.target_labels | join(', ') }}

{% endfor %}
{% else %}
*(none)*
{% endif %}

---

**Total Nodes: {{ card.total_nodes if card.total_nodes is defined else (card.node_names | length if card.node_names else 0) }}**
